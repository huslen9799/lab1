// /src/utils/api.ts
const BASE_URL = "http://iproneedful.mandakh.org"; // API-–Ω “Ø–Ω–¥—Å—ç–Ω URL —Ö–∞—è–≥–∏–π–≥ —Ç–æ–¥–æ—Ä—Ö–æ–π–ª–Ω–æ. –≠–Ω—ç –Ω—å –±“Ø—Ö —Ö“Ø—Å—ç–ª—Ç–∏–π–Ω —ç—Ö–ª—ç–ª –±–æ–ª–Ω–æ.

export interface ApiResponse<T> {
  // API-—Å –∏—Ä—ç—Ö —Ö–∞—Ä–∏—É–Ω—ã –µ—Ä”©–Ω—Ö–∏–π –±“Ø—Ç—Ü–∏–π–≥ —Ç–æ–¥–æ—Ä—Ö–æ–π–ª–æ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. T –Ω—å 'data' —Ç–∞–ª–±–∞—Ä—ã–Ω —Ç”©—Ä”©–ª.
  resultCode: number; // –•“Ø—Å—ç–ª—Ç–∏–π–Ω “Ø—Ä –¥“Ø–Ω–≥–∏–π–Ω –∫–æ–¥—ã–≥ (–∞–º–∂–∏–ª—Ç—Ç–∞–π —ç—Å–≤—ç–ª –∞–ª–¥–∞–∞) –∏–ª—ç—Ä—Ö–∏–π–ª—ç—Ö —Ç–æ–æ–Ω —É—Ç–≥–∞.
  resultMessage: string; // –•“Ø—Å—ç–ª—Ç–∏–π–Ω “Ø—Ä –¥“Ø–Ω–≥–∏–π–Ω –∫–æ–¥—ã–≥ —Ç–∞–π–ª–±–∞—Ä–ª–∞—Å–∞–Ω –º–µ—Å—Å–µ–∂.
  data: T; // –•“Ø—Å—ç–ª—Ç–∏–π–Ω –≥–æ–ª ”©–≥”©–≥–¥”©–ª, —Ç”©—Ä”©–ª –Ω—å 'T' –±–∞–π–Ω–∞.
  datasize: number; // 'data' —Ç–∞–ª–±–∞—Ä—Ç –±—É–π ”©–≥”©–≥–¥–ª–∏–π–Ω —Ö—ç–º–∂—ç—ç –±—É—é—É —Ç–æ–æ.
  curdate: string; // –°–µ—Ä–≤–µ—Ä –¥—ç—ç—Ä—Ö –æ–¥–æ–æ–≥–∏–π–Ω –æ–≥–Ω–æ–æ/—Ü–∞–≥.
  action: string; // –¢—É—Ö–∞–π–Ω “Ø–π–ª–¥–ª–∏–π–≥ —Ç–æ–¥–æ—Ä—Ö–æ–π–ª–æ—Ö –Ω—ç—Ä.
}

export type RequestBody = Record<string, unknown>; // API —Ö“Ø—Å—ç–ª—Ç—ç—ç—Ä –∏–ª–≥—ç—ç—Ö –±–∏–µ–∏–π–Ω (body) —Ç”©—Ä–ª–∏–π–≥ —Ç–æ–¥–æ—Ä—Ö–æ–π–ª–Ω–æ. Key –Ω—å string, —É—Ç–≥–∞ –Ω—å –¥—É—Ä—ã–Ω —Ç”©—Ä”©–ª –±–∞–π–Ω–∞.

export async function sendRequest<T = unknown>( // API-–¥ —Ö“Ø—Å—ç–ª—Ç –∏–ª–≥—ç—ç—Ö “Ø–Ω–¥—Å—ç–Ω –∞—Å–∏–Ω—Ö—Ä–æ–Ω —Ñ—É–Ω–∫—Ü. T –Ω—å —Ö–∞—Ä–∏—É–Ω—ã 'data' —Ç–∞–ª–±–∞—Ä—ã–Ω —Ç”©—Ä”©–ª, default-–∞–∞—Ä unknown.
  requestBody: RequestBody, // –•“Ø—Å—ç–ª—Ç—ç—ç—Ä –∏–ª–≥—ç—ç—Ö ”©–≥”©–≥–¥”©–ª (GET-—Ç Query Param, –±—É—Å–∞–¥ method-—Ç Body –±–æ–ª–Ω–æ).
  endpoint: string, // API-–Ω —Ç”©–≥—Å–≥”©–ª–∏–π–Ω —Ü—ç–≥ –±—É—é—É –∑–∞–º (–∂–∏—à—ç—ç –Ω—å: "/users").
  method: "POST" | "GET" | "PUT" | "DELETE" = "POST" // –•“Ø—Å—ç–ª—Ç–∏–π–Ω –∞—Ä–≥–∞ (HTTP method), default-–∞–∞—Ä POST.
): Promise<ApiResponse<T>> {
  // –§—É–Ω–∫—Ü –Ω—å 'ApiResponse<T>' —Ç”©—Ä–ª–∏–π–Ω “Ø—Ä –¥“Ø–Ω–≥ –±—É—Ü–∞–∞—Ö—ã–≥ –∞–º–ª–∞–∂ –±–∞–π–Ω–∞.
  const normalizedEndpoint = endpoint.startsWith("/") // endpoint-–∏–π–≥ —à–∞–ª–≥–∞–Ω–∞. –•—ç—Ä—ç–≤ "/"-—ç—ç—Ä —ç—Ö–ª—ç—ç–≥“Ø–π –±–æ–ª,
    ? endpoint // ”©”©—Ä—á–ª”©—Ö–≥“Ø–π “Ø–ª–¥—ç—ç–Ω—ç.
    : `/${endpoint}`; // —ç—Ö—ç–Ω–¥ –Ω—å "/" –Ω—ç–º–Ω—ç (URL –∑–∞–º –∑”©–≤ –±–∞–π—Ö—ã–Ω —Ç—É–ª–¥).
  const url = `${BASE_URL}${normalizedEndpoint}`; // “Æ–Ω–¥—Å—ç–Ω URL –±–æ–ª–æ–Ω endpoint-–∏–π–≥ –Ω—ç–≥—Ç–≥—ç–∂ –±“Ø—Ä—ç–Ω URL-–∏–π–≥ “Ø“Ø—Å–≥—ç–Ω—ç.
  const upperMethod = method.toUpperCase(); // –•“Ø—Å—ç–ª—Ç–∏–π–Ω –∞—Ä–≥—ã–≥ —Ç–æ–º “Ø—Å–≥—ç—ç—Ä –±–æ–ª–≥–æ–Ω–æ (HTTP method-—É—É–¥ —Ç–æ–º “Ø—Å–≥—ç—ç—Ä –±–∞–π—Ö —ë—Å—Ç–æ–π).

  try {
    // –ê–ª–¥–∞–∞–≥ –±–∞—Ä–∏—Ö (try-catch) –±–ª–æ–∫–∏–π–Ω —ç—Ö–ª—ç–ª.
    let finalUrl = url; // –≠—Ü—Å–∏–π–Ω URL-–∏–π–≥ —Ö–∞–¥–≥–∞–ª–∞—Ö —Ö—É–≤—å—Å–∞–≥—á, –∞–Ω—Ö–ª–∞–Ω –±“Ø—Ä—ç–Ω URL-—ç—ç—Ä —Ç–æ—Ö–∏—Ä—É—É–ª–Ω–∞.
    const options: RequestInit = {
      // fetch —Ñ—É–Ω–∫—Ü—ç–¥ –¥–∞–º–∂—É—É–ª–∞—Ö —Ç–æ—Ö–∏—Ä–≥–æ–æ–Ω—ã –æ–±—ä–µ–∫—Ç (RequestInit).
      method: upperMethod, // HTTP –∞—Ä–≥–∞.
      headers: {
        // –•“Ø—Å—ç–ª—Ç–∏–π–Ω —Ç–æ–ª–≥–æ–π –º—ç–¥—ç—ç–ª–ª“Ø“Ø–¥.
        "Content-Type": "application/json", // ”®–≥”©–≥–¥–ª–∏–π–Ω —Ç”©—Ä–ª–∏–π–≥ JSON –≥—ç–∂ –∑–∞–∞–Ω–∞.
      },
      cache: "no-store", // –ö—ç—à–ª—ç—Ö–≥“Ø–π –≥—ç–∂ –∑–∞–∞–Ω–∞ (—à–∏–Ω—ç ”©–≥”©–≥–¥”©–ª –∞–≤–∞—Ö –∑–æ—Ä–∏–ª–≥–æ–æ—Ä).
    };

    if (upperMethod === "GET") {
      // –•—ç—Ä—ç–≤ —Ö“Ø—Å—ç–ª—Ç–∏–π–Ω –∞—Ä–≥–∞ GET –±–æ–ª:
      const qs = new URLSearchParams( // URLSearchParams –æ–±—ä–µ–∫—Ç—ã–≥ “Ø“Ø—Å–≥—ç–Ω—ç (Query String “Ø“Ø—Å–≥—ç—Ö—ç–¥ —Ö—ç—Ä—ç–≥–ª—ç–Ω—ç).
        Object.entries(requestBody).reduce(
          // requestBody –æ–±—ä–µ–∫—Ç—ã–≥ [key, value] —Ö–æ—Å–ª–æ–ª—É—É–¥—ã–Ω –º–∞—Å—Å–∏–≤ –±–æ–ª–≥–æ–∂, –¥–∞—Ä–∞–∞ –Ω—å reduce-—ç—ç—Ä
          (acc, [key, val]) => ({
            // —à–∏–Ω—ç Query Param –æ–±—ä–µ–∫—Ç–æ–¥ —Ö—É–≤–∏—Ä–≥–∞–Ω–∞.
            ...acc, // ”®–º–Ω”©—Ö —Ö—É—Ä–∏–º—Ç–ª–∞–≥–¥—Å–∞–Ω —É—Ç–≥—É—É–¥—ã–≥ –∞–≤—á “Ø–ª–¥—ç–Ω—ç.
            [key]: val !== undefined && val !== null ? String(val) : "", // null/undefined –±–∏—à –±–æ–ª —É—Ç–≥—ã–≥ string –±–æ–ª–≥–æ–Ω–æ, “Ø–≥“Ø–π –±–æ–ª —Ö–æ–æ—Å–æ–Ω string –±–æ–ª–≥–æ–Ω–æ.
          }),
          {} as Record<string, string> // –ê–Ω—Ö–Ω—ã —É—Ç–≥–∞ - —Ö–æ–æ—Å–æ–Ω string-string Record.
        )
      ).toString(); // “Æ“Ø—Å–≥—ç—Å—ç–Ω URLSearchParams-–∏–π–≥ string –±–æ–ª–≥–æ–Ω–æ (–∂–∏—à—ç—ç –Ω—å: "param1=value1&param2=value2").

      finalUrl = qs ? `${url}?${qs}` : url; // –•—ç—Ä—ç–≤ Query String (qs) –±–∞–π–≤–∞–ª URL-–¥ "?qs" –Ω—ç–º–Ω—ç, “Ø–≥“Ø–π –±–æ–ª “Ø–Ω–¥—Å—ç–Ω URL-—ç—ç—Ä “Ø–ª–¥—ç—ç–Ω—ç.
    } else {
      // –•—ç—Ä—ç–≤ GET-—ç—ç—Å –±—É—Å–∞–¥ (POST, PUT, DELETE) –∞—Ä–≥–∞ –±–æ–ª:
      options.body = JSON.stringify(requestBody); // requestBody –æ–±—ä–µ–∫—Ç—ã–≥ JSON string –±–æ–ª–≥–æ–∂, —Ö“Ø—Å—ç–ª—Ç–∏–π–Ω –±–∏–µ–¥ (body) –æ—Ä—É—É–ª–Ω–∞.
    }

    // üî• –¢–∞–Ω—ã —Ö“Ø—Å—Å—ç–Ω—ç—ç—Ä fetch –¥—ç—ç—Ä —à—É—É–¥ await —Ö—ç—Ä—ç–≥–ª—ç–Ω—ç // –≠–Ω—ç –Ω—å —Ç–∞–π–ª–±–∞—Ä –±—É—Å, —Ö–∞—Ä–∏–Ω –∫–æ–¥—ã–Ω —Ö—ç—Å—ç–≥—Ç –æ—Ä—Å–æ–Ω —Ç–∞–π–ª–±–∞—Ä–ª–∞–≥—á –º–µ—Å—Å–µ–∂ –±–∞–π–Ω–∞.
    const response = await fetch(finalUrl, options); // –≠—Ü—Å–∏–π–Ω URL –±–æ–ª–æ–Ω —Ç–æ—Ö–∏—Ä–≥–æ–æ–≥–æ–æ—Ä API-–¥ —Ö“Ø—Å—ç–ª—Ç –∏–ª–≥—ç—ç–∂, —Ö–∞—Ä–∏—É–≥ —Ö“Ø–ª—ç—ç–∂ –∞–≤–Ω–∞.

    // HTTP-level –∞–ª–¥–∞–∞ // HTTP —Ç“Ø–≤—à–Ω–∏–π –∞–ª–¥–∞–∞–≥ —à–∞–ª–≥–∞—Ö —Ö—ç—Å—ç–≥.
    if (!response.ok) {
      // –•—ç—Ä—ç–≤ HTTP —Ö–∞—Ä–∏—É –∞–º–∂–∏–ª—Ç—Ç–∞–π (status 200-299) –±–∏—à –±–æ–ª:
      const text = response.statusText || `HTTP ${response.status}`; // –•–∞—Ä–∏—É–Ω—ã —Å—Ç–∞—Ç—É—Å—ã–Ω —Ç–µ–∫—Å—Ç–∏–π–≥ —ç—Å–≤—ç–ª HTTP —Å—Ç–∞—Ç—É—Å –∫–æ–¥—ã–≥ –∞–ª–¥–∞–∞–Ω—ã –º–µ—Å—Å–µ–∂ –±–æ–ª–≥–æ–Ω–æ.
      const errData = await response.json().catch(() => ({})); // –•–∞—Ä–∏—É–Ω—ã –±–∏–µ–∏–π–≥ JSON-–æ–æ—Ä —É–Ω—à–∏—Ö—ã–≥ –æ—Ä–æ–ª–¥–æ–Ω–æ, –∞–ª–¥–∞–∞ –≥–∞—Ä–≤–∞–ª —Ö–æ–æ—Å–æ–Ω –æ–±—ä–µ–∫—Ç –±–æ–ª–≥–æ–Ω–æ.
      throw new Error(errData.resultMessage || text); // –°–µ—Ä–≤–µ—Ä—ç—ç—Å –∏—Ä—Å—ç–Ω –∞–ª–¥–∞–∞–Ω—ã –º–µ—Å—Å–µ–∂ —ç—Å–≤—ç–ª HTTP —Å—Ç–∞—Ç—É—Å—ã–Ω —Ç–µ–∫—Å—Ç–∏–π–≥ –∞—à–∏–≥–ª–∞–Ω –∞–ª–¥–∞–∞ “Ø“Ø—Å–≥—ç–Ω—ç.
    }

    const json: ApiResponse<T> = await response.json(); // HTTP —Ö–∞—Ä–∏—É–Ω—ã –±–∏–µ–∏–π–≥ JSON —Ñ–æ—Ä–º–∞—Ç —Ä—É—É —Ö”©—Ä–≤“Ø“Ø–ª–∂, ApiResponse<T> —Ç”©—Ä–ª”©”©—Ä –∞–≤–Ω–∞.

    console.log(
      // –ö–æ–Ω—Å–æ–ª–¥ –∞–º–∂–∏–ª—Ç—Ç–∞–π —Ö–∞—Ä–∏—É–Ω—ã –º—ç–¥—ç—ç–ª–ª–∏–π–≥ —Ö—ç–≤–ª—ç–Ω—ç.
      `%c[API Response] ${endpoint} ‚Äî Code: ${json.resultCode}, Message: ${json.resultMessage}`, // –•—ç–≤–ª—ç—Ö –º–µ—Å—Å–µ–∂.
      "color:#00aa00;" // –ö–æ–Ω—Å–æ–ª—ã–Ω —Ç–µ–∫—Å—Ç–∏–π–Ω ”©–Ω–≥”©–Ω–∏–π —Ç–æ—Ö–∏—Ä–≥–æ–æ (–Ω–æ–≥–æ–æ–Ω ”©–Ω–≥”©”©—Ä).
    );

    return json; // JSON —Ö—ç–ª–±—ç—Ä—Ç—ç–π API —Ö–∞—Ä–∏—É–≥ –±—É—Ü–∞–∞–Ω–∞.
  } catch (error) {
    // try –±–ª–æ–∫–æ–¥ –∞–ª–¥–∞–∞ –≥–∞—Ä—Å–∞–Ω —Ç–æ—Ö–∏–æ–ª–¥–æ–ª–¥:
    console.error("sendRequest –∞–ª–¥–∞–∞:", error); // –ö–æ–Ω—Å–æ–ª–¥ –∞–ª–¥–∞–∞–≥ —Ö—ç–≤–ª—ç–Ω—ç.

    throw new Error( // –•—ç—Ä—ç–≥–ª—ç–≥—á–∏–¥ –æ–π–ª–≥–æ–º–∂—Ç–æ–π –∞–ª–¥–∞–∞–Ω—ã –º–µ—Å—Å–µ–∂ “Ø“Ø—Å–≥—ç–Ω—ç.
      error instanceof Error ? error.message : "“Æ–ª –º—ç–¥—ç–≥–¥—ç—Ö –∞–ª–¥–∞–∞ –≥–∞—Ä–ª–∞–∞." // –•—ç—Ä—ç–≤ error –Ω—å Error –æ–±—ä–µ–∫—Ç –±–æ–ª —Ç“Ø“Ø–Ω–∏–π message-–∏–π–≥, “Ø–≥“Ø–π –±–æ–ª –µ—Ä”©–Ω—Ö–∏–π –º–µ—Å—Å–µ–∂–∏–π–≥ –∞—à–∏–≥–ª–∞–Ω–∞.
    );
  }
}
